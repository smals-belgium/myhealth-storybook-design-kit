@use '@angular/material' as mat;
@use '../../core/variables' as mh;

@mixin override-mat-table() {
  @include mat.table-overrides(
    (
      header-headline-color: mh.$typography-brand-neutral-darker,
      header-headline-size: mh.$font-size-m,
      header-headline-weight: mh.$font-weight-semibold,
      row-item-outline-color: mh.$border-brand-neutral-lighter,
      row-item-label-text-size: mh.$font-size-m,
    )
  );

  @include mat.sort-overrides(
    (
      arrow-color: mh.$typography-brand-primary-medium,
    )
  );

  table.mat-mdc-table {
    margin-bottom: mh.$spacing-2xs;

    thead tr.mat-mdc-header-row {
      th.mat-mdc-header-cell {
        background-color: mh.$surface-brand-primary-lighter;
        border: none;

        &:first-child {
          border-top-left-radius: mh.$border-radius-m;
        }

        &:last-child {
          border-top-right-radius: mh.$border-radius-m;
        }

        &.mat-sort-header {
          /*
           * Hide sort icon on hover, focus, or when sorted
           * This is needed because the default behavior of Material is to show a sorting icon in any of these states.
           * It ensures that the custom icon we use gets replaced by this default sorting icon.
          */
          &:hover,
          &:focus,
          &[aria-sort='ascending'],
          &[aria-sort='descending'] {
            .mat-sort-header-content mat-icon {
              display: none;
            }

            .mat-sort-header-arrow {
              margin-right: 24px;
            }
          }

          mat-icon {
            @include mat.icon-overrides(
              (
                color: mh.$typography-brand-neutral-medium,
              )
            );
          }

          .mat-sort-header-arrow {
            transition: none;
          }
        }
      }
    }

    tbody {
      tr.mat-mdc-row {
        // Detail row
        &.mh-detail-row {
          // display: none;

          &--expanded {
            // display: table-row;
            background-color: mh.$surface-brand-neutral-lighter;
            border-bottom: mh.$border-width-s solid mh.$border-brand-neutral-lighter;
          }
        }

        // Previous row (expanded from column)
        &:has(+ tr.mat-mdc-row.mh-detail-row--expanded) {
          background-color: mh.$surface-brand-neutral-lighter;

          td.mat-mdc-cell {
            border-bottom: none;
          }
        }

        td.mat-column-expand,
        td.mat-column-actions {
          text-align: center;
        }
      }
    }

    /// @deprecated: Legacy styles for old expansion implementation
    tbody {
      tr.mat-mdc-row {
        &:has(+ tr.mh-detail-row td.mh-detail-row--expanded) {
          background-color: mh.$surface-brand-neutral-lighter;

          td.mat-mdc-cell {
            border-bottom: none;
          }
        }

        &.mh-detail-row {
          display: none;

          &:has(td.mh-detail-row--expanded) {
            display: table-row;
          }

          td.mat-mdc-cell {
            &.mh-detail-row--expanded {
              background-color: mh.$surface-brand-neutral-lighter;
              border-bottom: mh.$border-width-s solid mh.$border-brand-neutral-lighter;
            }
          }
        }
      }
    }
  }
}
